<!DOCTYPE html>
<html>
  <head>
    <meta name="description" content="">
    <meta name="author" content="Thomas Brace">

    <title>Contact Book</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

      <div id="app">
      </div>

      <script src="https://fb.me/react-15.0.0.js"></script>
      <script src="https://fb.me/react-dom-15.0.0.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.min.js"></script>
      <link rel="stylesheet" type="text/css" href="style.css">

      <script type="text/babel">

            class AppContainer extends React.Component { //parent Component
              constructor() {
                super();

                this.state = {
                  contactsList: [
                    {id:1, name: 'Tom Brace', phone: '0123456789', address:'fg dfgh dfgh dfgh dfgh', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:2, name: 'Kyle Barclay', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:3, name: 'Burt Lancaster', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:4, name: 'Jeannie Kyler', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:5, name: 'Ursella Phyllida', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:6, name: 'John Smith', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''},
                    {id:7, name: 'Dave Johnson', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''}
                  ],
                  selectedContact: {id:1, name: 'Tom Brace', phone: '0123456789', address:'fg dfgh dfgh dfgh dfg', notes: 'sdfdsfasdfasdf asdf as df asdf  sadf a sdfasdf', Quote:''}
                }
              }

              render(){
                return(
                  <div className="container-fluid">
                    <div className="row">
                      <div id="sidebar" className="col-sm-12 col-md-3 sidebar">
                        <ContactNav
                          updateSelectedContact={this._updateContact.bind(this)}
                          contactsList={this.state.contactsList}
                        />
                      </div>
                      <div id="content" className="col-sm-12 col-md-9 main">
                        <Content
                          selectedContact={this.state.selectedContact}
                          updateContact={this._updateContact.bind(this)}
                        />
                      </div>
                    </div>
                  </div>
                );
              };

              _updateContact(obj){
                var pos = this.state.contactsList.findIndex(x => x.id==obj.id) //find pos of item in array
                this.state.contactsList.splice(pos,1,obj) // replace orignal
                this.state.contactsList.sort(function(a,b) {return (a.name.toUpperCase() > b.name.toUpperCase()) ? 1 : ((b.name.toUpperCase() > a.name.toUpperCase()) ? -1 : 0);} ); //sort list
                this.setState({
                  selectedContact: obj
                });
              }
            }

            class ContactNav extends React.Component { //child of AppContainer

              render() {
                const contacts = this._getContacts() || [];
                return(
                  <div>
                    <div className="input-group">
                      <input id="contactsFilter" type="text" className="form-control" placeholder="Search for..." />
                      <span className="input-group-btn">
                        <button className="btn btn-default" type="button">Go!</button>
                      </span>
                    </div>
                    <ul className="nav nav-sidebar">
                      {contacts}
                    </ul>
                  </div>
                );
              }
              _handleClick(obj){
                event.preventDefault();
                this.props.updateSelectedContact(obj);
              }


              _getContacts() {
                return this.props.contactsList.map((i) => {
                  return (
                    <li key={i.id}>
                        <a href="#" key={i.id} onClick={() => this._handleClick(i) }>
                        {i.name}
                      </a>
                    </li>
                  );
                });
              }

              _filterContacts() {

                
              }

            }

            class Content extends React.Component { //child of AppContainer
              constructor() {
                super();
                this.state = {
                  isEditing: false
                }
              }

              _handleClickEdit() {
                event.preventDefault();
                this.setState({
                  isEditing: !this.state.isEditing
                });
              }

              _handleSubmit(){
                event.preventDefault();
                this.setState({
                  //toggle editing mode to opposite previous
                  isEditing: !this.state.isEditing
                });
                //build array of updated values
                const updtedContact = {
                  id: this.props.selectedContact.id, //need to incriment for new contacts
                  name: document.getElementById("name").value,
                  phone: document.getElementById("phone").value,
                  address: document.getElementById("address").value,
                  notes: document.getElementById("notes").value,
                  Quote: ""
                };
                //update parent state
                this.props.updateContact(updtedContact);
              }

              render() {
                let contactInfo = "";
                if(this.state.isEditing) {
                  contactInfo =
                      <form id="editContact" key={this.props.selectedContact.id}>
                        <div className="form-group form-group-lg">
                          <label for="name" className="col-xs-2 col-form-label">Name:</label>
                          <div className="col-xs-10"><input type="text" id="name" className="form-control" placeholder="Name" defaultValue={this.props.selectedContact.name} /></div>
                        </div>
                        <div className="form-group form-group-lg">
                          <label for="phone" className="col-xs-2 col-form-label">Phone Number:</label>
                          <div className="col-xs-10"><input type="text" id="phone" className="form-control" placeholder="phone" defaultValue={this.props.selectedContact.phone} /></div>
                        </div>
                        <div className="form-group form-group">
                          <label for="address" className="col-xs-2 col-form-label">Address:</label>
                          <div className="col-xs-10"><textarea type="text" id="address" className="form-control" placeholder="address" rows="3" defaultValue={this.props.selectedContact.address} /></div>
                        </div>
                        <div className="form-group form-group">
                          <label for="notes" className="col-xs-2 col-form-label">Notes:</label>
                          <div className="col-xs-10"><textarea type="text" id="notes" className="form-control" placeholder="notes" rows="3" defaultValue={this.props.selectedContact.notes} /></div>
                        </div>
                        <div className="form-group">
                          <div className="col-xs-offset-2 col-xs-10">
                            <button type="Update" className="btn btn-default" onClick={this._handleSubmit.bind(this)}>Update</button>
                          </div>
                        </div>
                      </form>;
                } else {
                  contactInfo =
                    <div className="col-xs-12">
                      <h1 className="page-header">{this.props.selectedContact.name}</h1>
                      <h3 className="sub-header">{this.props.selectedContact.phone}</h3>
                      <h6 className="sub-header">{this.props.selectedContact.address}</h6>
                      <h6 className="sub-header">{this.props.selectedContact.notes}</h6>
                    </div>;
                }

                return(
                  <div>
                    <div className="row">
                      <div className="btn-group pull-right" role="group">
                        <button type="button" className="btn btn-default" aria-label="Left Align" onClick={this._handleClickEdit.bind(this)} >
                          <span className="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                        </button>
                        <button type="button" className="btn btn-default" aria-label="Left Align">
                          <span className="glyphicon glyphicon-trash" aria-hidden="true"></span>
                        </button>
                      </div>
                    </div>
                    <div className="row">
                      {contactInfo}
                    </div>
                  </div>
                );
              }
            }


            ReactDOM.render(
              <AppContainer />, document.getElementById('app')
            );
      </script>
   </body>
</html>
